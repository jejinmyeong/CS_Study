`
💡 렌더링 엔진은 요청받은 내용을 브라우저 화면에 표시해주는 역할을 한다.
`

### DOM 트리, CSSOM 트리 구축 → 렌더 트리 구축 → 렌더 트리 배치 → 렌더 트리 그리기

<details>
<summary> DOM 트리, CSSOM 트리 구축 </summary>
<div markdown="1">
<br>

### DOM(Documentt Object Model), CSSOM(CSS Object Model) 생성

HTML을 파싱하여 DOM 노드를 만든다. 이 DOM 노드들을 병합하여 DOM  트리를 만든다.

CSS를 파싱하여 CSSOM 트리를 만들게 된다.

브라우저는 렌더링 할 문서를 HTML과 CSS로 나눠서 읽게 된다. 이 때 HTML과 CSS는 단순한 텍스트 이므로 각각 연산과 관리가 가능하도록 HTML parser와 CSS parser를 사용해 과닐가 가능한 Object Model로 만든다.

각 과정들이 점진적으로 진행된다는 것이 중요하다. 렌더링 엔진은 좀 더 나은 사용자 경험을 위해 가능하면 빠르게 내용을 표시하는데 모든 HTMl을 파싱할 때 까지 기다리지 않고 배치와 그리기 과정을 시작한다. 네트워크로부터 나머지 내용이 전송되기를 기다리는 동시에 받은 내용의 일부를 먼저 화면에 표시하는 것이다.

**HTML 파싱과 DOM 생성 과정**

1. 서버는 브라우저로부터 받은 HTML 파일을 읽은 후 메모리에 저장하고 그 메모리에 저장된 `바이트`를 응답한다.
2. 브라우저는 응답받은 바이트 형태의 문서를 meta 태그의 charset attribute에 지정된 인코딩방식에 따라 `문자열`로 반환한다.
3. 문자열로 반환된 HTML문서를 문법적 의미를 갖는 코드의 최소 단위인 `토큰`으로 분해한다.
4. 토큰들의 내용에 따라 객체로 변환하여 각 `노드`를 생성한다.
5. HTML은 요소 간의 부자 관계인 중첩 관계를 갖고 이를 반영하여 모든 노드들을 트리 구조로 구성하여 `DOM` 을 만든다.

**CSS 파싱과 CSSOM 생성 과정**

렌더링 엔진은 HTML 문서를 순차적으로 파싱하면서 DOM을 생성한다. 그러다 CSS를 로드하는 `link` 태그 혹은 `style` 태그를 만나면 DOM 생성을 중지한 후 CSS파싱의 결과물인 CSSOM을 생성하는 과정을 진행한다.

CSSOM 생성과정은 `바이트` → `문자` → `토큰` → `노드` → `CSSOM` 생성 순으로 HTML의 파싱과정과 동일하다.

**자바스크립트 파싱 과정**

렌더링 엔진은 HTML 문서를 순차적으로 파싱하다가 자바스크립트 파일을 로드하는 `script` 태그를 만나면 DOM 생성을 일시 중단한다.

script 태그의 src에 정의된 자바스크립트 파일을 서버에 요청하여 응답받으면 자바스크립트 코드를 파싱하기 위해 자바스크립트 엔진에게 제어권을 넘긴다.

자바스크립트 파싱이 끝나면 렌더링 엔진으로 다시 제어권을 넘기고 DOM 생성을 이어나간다.

만약 생성되지 않은 DOM을 조작한다면 에러가 발생할 수 있다. 따라서 body 요소 아래에 자바스크립트를 위치 시키거나 DOM 생성이 완료된 시점에서 자바스크립트가 실행되도록 한다.

1. 자바스크립트 코드를 tokenizer가 어휘를 분석하여 문법적 의미를 갖는 코드의 최소 단위인 `토큰`들로 분해하는데 이것을 tokenizing이라 한다.
2. 파서가 토큰을 구문분석하여 `AST`(Abstract Syntax Tree: 추상 구문 트리)로 파싱한다.
3. 바이트 코드 생성기가 AST를 `바이트코드`로 변환한다.
4. 인터프리터에 의해 바이트코드를 실행한다.

</div>
</details>